<!DOCTYPE html>
<html>
<head>
  <title>Edit Playlist</title>
</head>
<body>
  <h1>Edit Playlist: {{ name }}</h1>
  <form method="POST">
    <p><label>Playlist Name:<br>
      <input type="text" name="name" required value="{{ name }}">
    </label></p>

    <p><label>Match Type:<br>
      <select name="match">
        <option value="all" {% if match == "all" %}selected{% endif %}>All</option>
        <option value="any" {% if match == "any" %}selected{% endif %}>Any</option>
      </select>
    </label></p>

    <p><label>Limit:<br>
      <select name="limit">
        <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
        <option value="500" {% if limit == 500 %}selected{% endif %}>500</option>
        <option value="1000" {% if limit == 1000 %}selected{% endif %}>1000</option>
        <option value="9000" {% if limit == 9000 %}selected{% endif %}>9000</option>
      </select>
    </label></p>

    <h3>Conditions:</h3>
    <div id="rules-container">
      {% for cond in conditions %}
        {% if cond.conditions is defined %}
          <div class="rule-group">
            <strong>Group ({{ cond.match | upper }}):</strong>
            {% for subcond in cond.conditions %}
              <div class="rule-row">
                <select name="field[]">
                  <option value="artist" {% if subcond.field == "artist" %}selected{% endif %}>Artist</option>
                  <option value="track_name" {% if subcond.field == "track_name" %}selected{% endif %}>Track Name</option>
                  <option value="is_liked" {% if subcond.field == "is_liked" %}selected{% endif %}>Is Liked</option>
                  <option value="play_count" {% if subcond.field == "play_count" %}selected{% endif %}>Play Count</option>
                  <option value="last_played_at" {% if subcond.field == "last_played_at" %}selected{% endif %}>Last Played</option>
                </select>

                <select name="operator[]">
                  <option value="eq" {% if subcond.operator == "eq" %}selected{% endif %}>=</option>
                  <option value="neq" {% if subcond.operator == "neq" %}selected{% endif %}>!=</option>
                  <option value="gt" {% if subcond.operator == "gt" %}selected{% endif %}>&gt;</option>
                  <option value="lt" {% if subcond.operator == "lt" %}selected{% endif %}>&lt;</option>
                  <option value="contains" {% if subcond.operator == "contains" %}selected{% endif %}>contains</option>
                </select>

                <input type="text" name="value[]" value="{{ subcond.value }}">
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="rule-row">
            <select name="field[]">
              <option value="artist" {% if cond.field == "artist" %}selected{% endif %}>Artist</option>
              <option value="track_name" {% if cond.field == "track_name" %}selected{% endif %}>Track Name</option>
              <option value="is_liked" {% if cond.field == "is_liked" %}selected{% endif %}>Is Liked</option>
              <option value="play_count" {% if cond.field == "play_count" %}selected{% endif %}>Play Count</option>
              <option value="last_played_at" {% if cond.field == "last_played_at" %}selected{% endif %}>Last Played</option>
            </select>

            <select name="operator[]">
              <option value="eq" {% if cond.operator == "eq" %}selected{% endif %}>=</option>
              <option value="neq" {% if cond.operator == "neq" %}selected{% endif %}>!=</option>
              <option value="gt" {% if cond.operator == "gt" %}selected{% endif %}>&gt;</option>
              <option value="lt" {% if cond.operator == "lt" %}selected{% endif %}>&lt;</option>
              <option value="contains" {% if cond.operator == "contains" %}selected{% endif %}>contains</option>
            </select>

            <input type="text" name="value[]" value="{{ cond.value }}">
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <h3>Sort By:</h3>
    {% set sort = sort_rules %}
    <div class="sort-row">
      <select name="sort_by">
        <option value="last_played_at" {% if sort and sort[0].by == "last_played_at" %}selected{% endif %}>Last Played</option>
        <option value="play_count" {% if sort and sort[0].by == "play_count" %}selected{% endif %}>Play Count</option>
      </select>
      <select name="sort_direction">
        <option value="asc" {% if sort and sort[0].direction == "asc" %}selected{% endif %}>Ascending</option>
        <option value="desc" {% if sort and sort[0].direction == "desc" %}selected{% endif %}>Descending</option>
      </select>
    </div>

    <br>
    <button type="submit">ðŸ’¾ Save Changes</button>
    <a href="/dashboard"><button type="button">ðŸ”™ Back</button></a>
  </form>
</body>
</html>