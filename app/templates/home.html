{% extends "base.html" %}

{% block title %}Spotify Tracker Home{% endblock %}

{% block content %}
<h1>Welcome to Your Spotify Tracker</h1>

{% if can_sync %}
<div style="display: flex; flex-direction: column; align-items: center; margin-top: 2rem;">
  <style>
    @media (max-width: 600px) {
      .btn-container {
        flex-direction: column !important;
        align-items: stretch !important;
      }
      .btn-container > * {
        width: 100% !important;
      }
    }
  </style>
  {% if is_first_sync %}
    <form method="POST" action="{{ url_for('playlist_dashboard.run_initial_sync') }}">
      <button type="submit" class="btn">🔁 Run Initial Sync</button>
    </form>
  {% else %}
    <div style="display:flex; gap: 0.75rem; flex-wrap: wrap; justify-content:center;">
      <div style="display: flex; flex-direction: column; align-items: center;">
        <form method="POST" action="{{ url_for('playlist_dashboard.run_initial_sync') }}">
          <button type="submit" class="btn">🔁 Run Full Sync Now</button>
        </form>
        <br>
        <small style="color: #6c757d; margin-top: 0.25rem; text-align: center; max-width: 220px; display: block;">
          Full sync will run the entire update process, checking for additions and removals. Can take longer.
        </small>
      </div>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <form method="POST" action="{{ url_for('playlist_dashboard.run_lite_sync') }}">
          <button type="submit" class="btn">🔁 Run Lite Sync Now</button>
        </form>
        <br>
        <small style="color: #6c757d; margin-top: 0.25rem; text-align: center; max-width: 220px; display: block;">
          Lite sync will check the last 100 album additions and make sure all are added. It will not look for any removals from the library.
        </small>
      </div>
    </div>
    <div class="btn-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 1rem;">
      <a href="/dashboard/playlists" class="btn">🎛️ Playlist Dashboard</a>
      <a href="/dashboard/create-playlist" class="btn">➕ Create Playlist</a>
      <a href="/metrics" class="btn">📊 View Metrics</a>
      <a href="/logs" class="btn">📜 View Logs</a>
      <a href="/diagnostics" class="btn">🧪 Diagnostics</a>
    </div>
  {% endif %}
</div>
{% endif %}

{% include "footer.html" %}

{% block scripts %}
<script>
  const syncForm = document.querySelector('form[action="{{ url_for("playlist_dashboard.run_initial_sync") }}"]');
  if (syncForm) {
    syncForm.addEventListener('submit', function (e) {
      const button = syncForm.querySelector('button');
      button.disabled = true;
      const originalText = button.innerHTML;
      button.innerHTML = '⏳ Sync in progress...';
      setTimeout(() => {
        button.disabled = false;
        button.innerHTML = originalText;
      }, 30000); // re-enable after 30s just in case
    });
  }
</script>
{% endblock %}
{% endblock %}